<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>index.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Booru.html">Booru</a><ul class='methods'><li data-type='method'><a href="Booru.html#postView">postView</a></li><li data-type='method'><a href="Booru.html#search">search</a></li></ul></li><li><a href="Post.html">Post</a></li></ul><h3>Interfaces</h3><ul><li><a href="IBooru.html">IBooru</a><ul class='methods'><li data-type='method'><a href="IBooru.html#postView">postView</a></li><li data-type='method'><a href="IBooru.html#search">search</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#BooruError">BooruError</a></li><li><a href="global.html#commonfy">commonfy</a></li><li><a href="global.html#search">search</a></li><li><a href="global.html#sites">sites</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//@ts-check
// Declare the dependencies
const snekfetch = require('snekfetch')

const Constants = require('./src/Constants.js')
const { BooruError } = Constants
const Utils = require('./src/Utils.js')
const IBooru = require('./src/boorus/IBooru.js')

const BooruTypes = {
  'json': require('./src/boorus/JsonBooru.js'),
  'xml': require('./src/boorus/XmlBooru.js'),
  'derpi': require('./src/boorus/Derpibooru.js'),
}

/**
 * Create a new booru to search with
 * @extends {IBooru}
 * @constructor
 * @param {String} site The {@link Site} (or alias of it) to create a booru from
 * @param {*} credentials The credentials to use on this booru
 * @return {IBooru} A booru to use
 *
 * @example
 * const Booru = require('booru')
 * // Aliases are supported
 * const e9 = new Booru('e9')
 *
 * // You can then search the site
 * const imgs = await e9.search(['cat', 'cute'], {limit: 3})
 *
 * // And use the images
 * imgs.forEach(i => console.log(i.common.file_url))
 *
 * // Or access other methods on the Booru
 * e9.postView(imgs[0].common.id)
 */
function Booru(site, credentials = null) {
  const rSite = Utils.resolveSite(site)

  if (rSite === null) {
    throw new BooruError('Site not supported')
  }

  const booruSite = Constants.sites[rSite]

  return new BooruTypes[booruSite.type](booruSite, credentials)
}

const booruCache = {}

/**
 * Searches a site for images with tags and returns the results
 * @param {String} site The site to search
 * @param {String[]} [tags=[]] Tags to search with
 * @param {Object} [searchOptions={}] The options for searching
 * @param {Number|String} [searchOptions.limit=1] The limit of images to return
 * @param {Boolean} [searchOptions.random=false] If it should grab randomly sorted results
 * @return {Promise&lt;Post[]>} A promise with the images as an array of objects
 *
 * @example
 * const Booru = require('booru')
 * // Returns a promise with the latest cute glace pic from e926
 * Booru.search('e926', ['glaceon', 'cute'])
 */
function search(site, tags = [], {limit = 1, random = false} = {}) {
  const rSite = Utils.resolveSite(site)
  limit = parseInt(limit)

  if (rSite === null) {
    throw new BooruError('Site not supported')
  }

  if (!(tags instanceof Array)) {
    throw new BooruError('`tags` should be an array')
  }

  if (typeof limit !== 'number' || Number.isNaN(limit)) {
    throw new BooruError('`limit` should be an int')
  }

  // Too lazy to remove validation (for now)

  const booruSite = Constants.sites[rSite]

  if (!booruCache[rSite]) {
    booruCache[rSite] = new BooruTypes[booruSite.type](booruSite)
  }

  return booruCache[rSite].search(tags, {
    limit,
    random
  })
}

/**
 * Deprecated, now a noop
 * Just access &lt;{@link BooruImage}>.common and it'll be auto-generated as you get it
 *
 * @deprecated Just use &lt;{@link BooruImage}>.common instead
 * @param  {*} images Array of {@link BooruImage} objects
 * @return {*} Array of {@link BooruLink} objects
 */
function commonfy(images) {
  return Promise.resolve(images)
}

module.exports = Booru

module.exports.search = search
module.exports.commonfy = commonfy // do nothing
module.exports.sites = Constants.sites // Sites in case you want to see what it supports
module.exports.resolveSite = Utils.resolveSite // might as well /shrug

// coding is fun :)
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Feb 28 2018 12:42:55 GMT-0500 (STD) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
